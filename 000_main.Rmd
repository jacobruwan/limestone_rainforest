---
title: "Langkawi Island Limestone Rainforest Project"
author: 'MXB344 Students: Jacob, Nick and Ricky'
date: 'Brainstorm: 24 August 2017. Analysis: 3rd October'
output:
  html_document:
    code_folding: hide
    df_print: paged
    fig_caption: yes
    fig_height: 3
    fig_width: 5
    highlight: tango
    number_section: yes
    theme: sandstone
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
  word_document:
    toc: yes
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE)

# Function to automatically install missing libraries and load all.
# Sourced from internet: 
instant_pkgs <- function(pkgs) {  
  pkgs_miss <- pkgs[which(!pkgs %in% installed.packages()[, 1])] 
  if (length(pkgs_miss) > 0) { 
    install.packages(pkgs_miss) 
  } 
  
  if (length(pkgs_miss) == 0) { 
    message("\n ...Packages were already installed!\n") 
  } 
  
  # install packages not already loaded: 
  pkgs_miss <- pkgs[which(!pkgs %in% installed.packages()[, 1])] 
  if (length(pkgs_miss) > 0) { 
    suppressPackageStartupMessages(install.packages(pkgs_miss)) 
  } 
  
  # load packages not already loaded: 
  attached <- search() 
  attached_pkgs <- attached[grepl("package", attached)] 
  need_to_attach <- pkgs[which(!pkgs %in% gsub("package:", "", attached_pkgs))] 
  
  if (length(need_to_attach) > 0) { 
    for (i in 1:length(need_to_attach)) 
      suppressPackageStartupMessages(require(need_to_attach[i], character.only = TRUE)) 
  } 
  
  if (length(need_to_attach) == 0) { 
    message("\n ...Packages were already loaded!\n") 
  } 
} 

# Define packages to load run instant_pkgs
packages_to_load <- c("readxl", "dplyr", "tidyr", "magrittr", 
                      "ggplot2", "ggthemes", "lubridate",
                      "lme4", "INLA", "stringr", "scales", "splines")

instant_pkgs(packages_to_load)
```

```{r}
# Aesthetics for GGplot
bg_green <- rgb(223, 241, 204, maxColorValue = 255)
bg_table_pastel <- rgb(255, 242, 204, maxColorValue = 255)
colours.site = c("#d62121", "#30d621")
colours.splinefit = c("#b21515", "#21b623", colours.site[1], colours.site[2], "#d92121", "#33d621")

theme_project <- function() {
  theme_bw() +
  theme(legend.position = "top") +
  theme(legend.background = element_rect(bg_green),
        legend.box.background = element_rect(fill=bg_green, color=bg_green),
        legend.key = element_rect(fill=bg_green),
        plot.background = element_rect(bg_green, color=bg_green)) 
}

theme_table_pastel <- function() {
  theme_bw() +
  theme(legend.position = "top") +
  theme(legend.background = element_rect(bg_table_pastel),
        legend.box.background = element_rect(fill=bg_table_pastel, color=bg_table_pastel),
        legend.key = element_rect(fill=bg_table_pastel),
        plot.background = element_rect(bg_table_pastel, color=bg_table_pastel)) 
}

# Define the datafolder that contains all RDatasets. This will be an empty string when submitted
data_folder <- "C:\\Users\\Jacob\\Dropbox\\Semester 2 2017\\MXB344\\Project\\Data\\"
```

# Abstract


# Background
Is there a relationship between understory diversity and forest disturbance.

## Research Questions
  1. $H_0$: Is the cover, Shannon's diversity index and specific leaf area of the three dominant species in the forest (either individually or together) different between pristine and disturbed areas of the limestone forest? If so, then how do these differ between the two areas?
  2. $H_0$: Is the temperature and humidity different between pristine and disturbed areas of the limestone forest?
  3. $H_0$: Can species richness be predicted based on other data which are much cheaper (in terms of time and effort) to collect?


The three research questions require an investigation of six research variables:

  1. Temperature
  2. Dominant Seedling Cover
  3. Dominant Shannon's Index of Diversity
  4. 






  * leaf economic spectrum (energy from the sun)
    * most important: its an important investment
    * SLA weighted by species abundance
      * Garnier paper
    * Resource conservation and resource acquisition
      * Defence invests in tissue (retaining water)
      * Acquisition (high sla)
  * Shannons diversity index
    * Can use a different measure?
  * Seedling cover
  * Leaf Traits
    * 1. Why care about them?
  * Explain what we don't know about the study
  * standardised major size correlation??
  * Plastic response: geno type -> triggered phenotype -> 
  * Structural equation model
  * ASK JENN FOR HER POWERPOINT
  * Catharsis.. Need to focus on the bigger picture
  
  
  
  * Function consequences
    * Use cover for shannons and simpsons, rather than abundance
    * 


# Experimental Design
```{r, child = '001_experimental_design.Rmd'}
```

# Data
## Data Build
```{r, child = '010_data_preparation.Rmd'}
```

## Data Quality
```{r, child = '011_data_quality.Rmd'}
```

# Analysis
The models used throughout this report are generalised linear mixed effects models, in a bayesian paradigm. Mixed effects models enable the variation of the response variable to be explained by fixed and random effects. Fixed effects represent the predictor variables that are of direct interest, such as disturbance or dominant species id. Random effects represent variables that are known to cause variation in the response variable, but are not of direct interest.
  
The fixed effects include all abiotic and biotic variables that are collected throughout the experiment. The final model will represent the most predictive subset of these variables. The random effects of each model include variation between transects, and variation between quadrats nested in transects. This structure is necessary due to the experimental design, and will remain constant for every model (i.e. not form part of the model selection).

The choice between a linear mixed effects model (LMM) and generalised linear mixed effects model (GLMM) depends on the domain of the response variable. GLM's transform the predictors of the linear model from the real scale into the correct domain through a canonical link function. For example, Species Richness can only be a positive integer value. Thus, a Poisson GLM can be used with a log-link function to model the average species richness based on predictor variables.

The bayesian paradigm is utilised for it's simplicity in model fit evaluation and the ability to handle a mixed effects structure in GLMM's. The mixed effects structure requires the value of a conditional probability:

$$ Insert the equation  $$
The frequentist paradigm is limited as it requires the difficult integration of this conditional probability, with various approximation methods used. However, the bayesian paradigm uses this probability directly and more efficiently. The modelling method used throughout this report is Integrated Nested Laplace Approximation (INLA). Essentially, INLA matches the posterior distribution of each parameter based on the mode and spread of the data.

This section demonstrates the model development process. The data is explored through meaningful graphs that identify visual patterns within the data. This information guides the model development, which aims to quantify the relationship between the predictors and response variables. 

  * Model/variable selection is evaluated on the highest Marginal log-Likelihood. 
  * Model fit is evaluated on residuals plots and whether the CPO PIT values are approximately uniformly/normally distributed.
  * Model outcomes are presented with credible intervals of estimated parameters. Additional credible intervals are shown that demonstrate the real effect of parameters with interactions.

The following subsections are segmented into an exploratory analysis and model development of each research question's response variables. 

## Temperature (RQ2)
### Exploratory Analysis
```{r, child = '020_exploratory_abiotic.Rmd'}
```

## Dominant Seedling Cover (RQ1)
### Exploratory Analysis
```{r, child = '030_exploratory_cover.Rmd'}
```

### Model Development
```{r, child = '031_model_cover.Rmd'}
```


## Dominant Shannon's Index of Diversity
### Exploratory Analysis
```{r, child = '040_exploratory_shannons.Rmd'}
```

### Model Development
```{r, child = '041_model_shannons.Rmd'}
```

## Dominant Specific Leaf Area
### Aggregated
#### Exploratory Analysis
```{r, child = '050_exploratory_sla_cagg.Rmd'}

```

### Model Development
```{r, child = '051_model_sla_cagg.Rmd'}

```

### Individual Species
#### Exploratory Analysis
```{r, child = '052_exploratory_sla_cweight.Rmd'}

```

### Model Development
```{r, child = '053_model_sla_cweight.Rmd'}

```

## Species Richness
### Exploratory Analysis
```{r, child = '060_exploratory_richness.Rmd'}
```

### Model Development
```{r, child = '061_model_richness.Rmd'}
```


# Model Outcomes


# Discussion




# Conclusion
















