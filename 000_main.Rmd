---
title: "Langkawi Island Limestone Rainforest Project"
author: 'MXB344 Students: Jacob, Nick and Ricky'
date: 'Brainstorm: 24 August 2017. Analysis: 3rd October'
output:
  html_document:
    code_folding: hide
    df_print: paged
    fig_caption: yes
    fig_height: 3
    fig_width: 5
    highlight: tango
    number_section: yes
    theme: sandstone
    toc: yes
    toc_depth: 3
    toc_float: yes
  word_document:
    toc: yes
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, fig.height = 3, fig.width)

# Function to automatically install missing libraries and load all.
# Sourced from internet: 
instant_pkgs <- function(pkgs) {  
  pkgs_miss <- pkgs[which(!pkgs %in% installed.packages()[, 1])] 
  if (length(pkgs_miss) > 0) { 
    install.packages(pkgs_miss) 
  } 
  
  if (length(pkgs_miss) == 0) { 
    message("\n ...Packages were already installed!\n") 
  } 
  
  # install packages not already loaded: 
  pkgs_miss <- pkgs[which(!pkgs %in% installed.packages()[, 1])] 
  if (length(pkgs_miss) > 0) { 
    suppressPackageStartupMessages(install.packages(pkgs_miss)) 
  } 
  
  # load packages not already loaded: 
  attached <- search() 
  attached_pkgs <- attached[grepl("package", attached)] 
  need_to_attach <- pkgs[which(!pkgs %in% gsub("package:", "", attached_pkgs))] 
  
  if (length(need_to_attach) > 0) { 
    for (i in 1:length(need_to_attach)) 
      suppressPackageStartupMessages(require(need_to_attach[i], character.only = TRUE)) 
  } 
  
  if (length(need_to_attach) == 0) { 
    message("\n ...Packages were already loaded!\n") 
  } 
} 

# Define packages to load run instant_pkgs
packages_to_load <- c("readxl", "dplyr", "tidyr", "magrittr", 
                      "ggplot2", "ggthemes", "lubridate",
                      "lme4", "INLA", "stringr", "scales", "splines")

instant_pkgs(packages_to_load)
```

```{r}
# Aesthetics for GGplot
bg_green <- rgb(223, 241, 204, maxColorValue = 255)
bg_table_pastel <- rgb(255, 242, 204, maxColorValue = 255)
colours.site = c("#d62121", "#30d621")
colours.splinefit = c("#b21515", "#21b623", colours.site[1], colours.site[2], "#d92121", "#33d621")

# Define backgroun_colour as bg_green for presentation
colours.background <- "white"

theme_project <- function() {
  theme_bw() +
  theme(legend.position = "top") +
  theme(legend.background = element_rect(colours.background),
        legend.box.background = element_rect(fill=colours.background, color=colours.background),
        legend.key = element_rect(fill=colours.background),
        plot.background = element_rect(colours.background, color=colours.background)) 
}

theme_table_pastel <- function() {
  theme_bw() +
  theme(legend.position = "top") +
  theme(legend.background = element_rect(bg_table_pastel),
        legend.box.background = element_rect(fill=bg_table_pastel, color=bg_table_pastel),
        legend.key = element_rect(fill=bg_table_pastel),
        plot.background = element_rect(bg_table_pastel, color=bg_table_pastel)) 
}

## Introduce multiplot function by Peter Haschke http://www.peterhaschke.com/r/2013/04/24/MultiPlot.html 
## This function is sourced from the internet. It is used to compare two plots of different datasets on a similar grid
multiplot <- function(..., plotlist = NULL, file, cols = 1, layout = NULL) {
  require(grid)

  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  if (is.null(layout)) {
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

  if (numPlots == 1) {
    print(plots[[1]])

  } else {
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    for (i in 1:numPlots) {
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

# Change Data Folder
```{r}
# Define the datafolder that contains all RDatasets. This will be an empty string when submitted
data_folder <- "C:\\Users\\Jacob\\Dropbox\\Semester 2 2017\\MXB344\\Project\\Data\\"
```

# Abstract


# Background

_Lankgawi Island's Limestone Rainforests_



_Understorey Seedling Species_



_Dominant Species_



_Target Resolutions_


## Research Questions
The three main research questions are:

  1. $H_0$: Is the cover, Shannon's diversity index and specific leaf area of the three dominant species in the forest (either individually or together) different between pristine and disturbed areas of the limestone forest? If so, then how do these differ between the two areas?
  2. $H_0$: Is the temperature and humidity different between pristine and disturbed areas of the limestone forest?
  3. $H_0$: Can species richness be predicted based on other data which are much cheaper (in terms of time and effort) to collect?

At a high level, abiotic indicators are investigated to quantify the disturbance conditions of the rainforest. Where as biotic variables are investigated to evaluate the impact of this disturbance on the ecosystem. Each question will be explain in further detail to identify the ecological meaning.

### Dominant Species Seedling Cover




### Dominant Species Shannon's Index of Diversity




### Dominant Species Specific Leaf Area

_Specific Leaf Area_
The purpose of investigating specific leaf area, referred to as SLA in this report, is the insight is provides into a plants strategy in the ecosystem. Plants are in constant competition for resources within their community. One core resource required is light. This presents one of the most competitive strategies employed by a plant: how they invest growth into their leaves, the apparatus used to capture light. A larger leaf will capture more light, and enable faster growth. However, with a limited amount of energy available, the plant must sacrifice the thickness of their leaves. This makes the plant more susceptible to damage from herbivores.

This presents a trade-off between the growth and defence mechanisms of the plant. SLA is a measure of this trade-off, calculated as the one-sided leaf area divided by the dry mass. SLA is used to relatively compare different species within the same community, categorising plants as resource acquisition or resource conservation. A relatively high SLA can suggest the plant has a need to compete more aggressively for light that other species within the same community.

_Investigation of Weighted and Aggregated SLA_
To provide a thorough comparison of the SLA between species and between disturbance, the SLA is weighted by each plants contribution to the community. This is calculated as the SLA of each leaf, weighted by the amount of area coverage the plant has in its community. This weighting takes into account how established a plant is in the community, and provides an insight to how this dominance affects a plant's investment strategy. This weighted measure is used to quantify the difference between species. To measure the difference due to disturbance, each species is aggregated to the community level. From Grime 2004, we know that dominant species have a large influence on the ecosystem, so this aggregation determines the growth strategy of the community.


_*REFERENCES*_
Quested, H., Eriksson, O., Fortunel, C., & Garnier, E. (2007). Plant Traits Relate to Whole-Community Litter Quality and Decomposition following Land Use Change. Functional Ecology,21(6), 1016-1026. Retrieved from http://www.jstor.org.ezp01.library.qut.edu.au/stable/20142742 

Pakeman, R., Garnier, E., Lavorel, S., Ansquer, P., Castro, H., Cruz, P., . . . Vile, D. (2008). Impact of Abundance Weighting on the Response of Seed Traits to Climate and Land Use. Journal of Ecology, 96(2), 355-366. Retrieved from http://www.jstor.org.ezp01.library.qut.edu.au/stable/20143472 


### Temperature




# REFERENCES NEEDED


### Species Richness









# Experimental Design

_Disturbance_


_Design and Method_





```{r, child = '001_experimental_design.Rmd'}
```

# Data
All raw data collected throughout the experiment was compiled into a single excel workbook. This data was cleaned and manipulated into five modelling datasets, for each research question. All numeric predictor variables are scaled to the standard normal distribution, to prevent numerical errors in the model development and enable a fair comparison between estimates.

```{r, child = '010_data_preparation.Rmd'}
```

## Data Quality
```{r, child = '011_data_quality.Rmd'}
```






# Analysis
The models used throughout this report are generalised linear mixed effects models. This section will outline how and why these models are required, and will provide an overview of the model development process.

_Mixed Effects_

Mixed effects models enable the variation of the response variable to be explained by fixed and random effects. Fixed effects represent the predictor variables that are of direct interest, such as disturbance or dominant species id. Random effects represent variables that are known to cause variation in the response variable, but are not of direct interest.
  
The fixed effects include all abiotic and biotic variables that are collected throughout the experiment. The final model will represent the most predictive subset of these variables. The random effects of each model include variation between transects, and variation between quadrats nested in transects. This structure is necessary due to the experimental design, and will remain constant for every model (i.e. not form part of the model selection).

_Generalised Linear Mixed Effects_

The choice between a linear mixed effects model (LMM) and generalised linear mixed effects model (GLMM) depends on the domain of the response variable. GLM's transform the predictors of the linear model from the real scale into the correct domain through a link function. For example, Species Richness can only be a positive integer value. Thus, a Poisson GLM can be used with a log-link function to model the average species richness.

_Bayesian Model_

The bayesian paradigm is utilised for it's ability to handle a mixed effects structure in GLMM's. The mixed effects structure requires the value of a conditional probability:

$$ Insert the equation  $$
The frequentist paradigm is limited as it requires the difficult integration of this conditional probability, with various approximation methods used. However, the bayesian paradigm uses this probability directly and more efficiently. The modelling method used throughout this report is Integrated Nested Laplace Approximation (INLA). Essentially, INLA matches the posterior distribution of each parameter based on the mode and spread of the data.

The bayesian model estimates a distribution for each parameter in the model. These distributions are 

_Process Overview_

This section demonstrates the model development process. The data is explored through meaningful graphs that identify visual patterns within the data. This information guides the model development, which aims to quantify the relationships between the predictor and response variable. 

  * Model/variable selection is evaluated on the maximum Marginal log-Likelihood and Credible Intervals that do not contain zero. 
    * Additional credible intervals are shown that demonstrate the real effect of parameters with interactions.
  * Model fit is evaluated on residual plots and whether the CPO PIT values are approximately uniformly/normally distributed.

The following subsections are segmented into an exploratory analysis and model development of each research question's response variables. 

## Temperature
### Exploratory Analysis
```{r, child = '020_exploratory_abiotic.Rmd'}
```

### Model Outcomes
*RUWAN* write stuff: Risk Ratio (RR) of credible intervals


## Dominant Seedling Cover
### Exploratory Analysis
```{r, child = '030_exploratory_cover.Rmd'}
```

### Model Development
```{r, child = '031_model_cover.Rmd'}
```

### Model Outcomes
*RICKY* write stuff: Risk Ratio (RR) of credible intervals

## Dominant Shannon's Index of Diversity
### Exploratory Analysis
```{r, child = '040_exploratory_shannons.Rmd'}
```

### Model Development
```{r, child = '041_model_shannons.Rmd'}
```


### Model Outcomes
*Nick* write stuff: Risk Ratio (RR) of credible intervals


## Dominant Specific Leaf Area
### Aggregated
#### Exploratory Analysis
```{r, child = '050_exploratory_sla_cagg.Rmd'}

```

#### Model Development
```{r, child = '051_model_sla_cagg.Rmd'}

```


#### Model Outcomes
*Ruwan* write stuff: Risk Ratio (RR) of credible intervals


### Individual Species
#### Exploratory Analysis
```{r, child = '052_exploratory_sla_cweight.Rmd'}

```

#### Model Development
```{r, child = '053_model_sla_cweight.Rmd'}

```


#### Model Outcomes
*Ruwan* write stuff: Risk Ratio (RR) of credible intervals


## Species Richness
### Exploratory Analysis
```{r, child = '060_exploratory_richness.Rmd'}
```

### Model Development
```{r, child = '061_model_richness.Rmd'}
```


### Model Outcomes
*Ricky* write stuff: Risk Ratio (RR) of credible intervals



# Discussion
## Ecological Meaning of Model Outcomes

_Temperature_


_Seedling Cover_


_Shannons Index of Diversity_


_Specific leaf Area_


_Species Richness_


# Limitations
The first limitation occurred for the leaf sample measurements, due the low sensitivity of the weighing scales. This was overcome by measuring the total weight of all leaf samples, per species per quadrat, and calculating the mean. This provides misleading results for the small or large leaves of the sample, which deviate significantly from the mean weight.

The main limitation was due to the equipment available for the experiment overseas. No oven was available for drying leaves or filter paper, which resulted in the moisture content being an uncontrolled variable. This affects the dry leaf mass and filter paper weight measurements.

Another limitation was a result of the limited time available to collect data such as temperature readings and soil decomposition. This prevented a throrough analysis of the variation in temperature at the rainforest. This also prevented the filter paper to adequately capture any difference in decomposition rates from the rainforest.


# Conclusion and Recommendations


# Appendix













